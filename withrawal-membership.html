<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Runbickers | 회원탈퇴</title>
  <meta name="description" content="Runbickers 계정 회원탈퇴 페이지" />
  <style>
    :root {
      --bg: #f5f7fb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --primary: #22c55e;
      --primary-600: #16a34a;
      --danger: #ef4444;
      --danger-600: #dc2626;
      --shadow: 0 8px 24px rgba(0,0,0,0.08);
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Noto Sans KR", "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
    }
    main { min-height: 100dvh; display: grid; place-items: center; padding: 24px; }
    .card {
      width: 100%;
      max-width: 540px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 28px;
    }
    h1 {
      font-size: 28px;
      margin: 0 0 6px;
      text-align: center;
      font-weight: 800;
    }
    .subtitle {
      margin: 0 0 18px;
      color: var(--muted);
      text-align: center;
    }
    form .field { margin-bottom: 14px; }
    label { display: block; font-weight: 700; margin-bottom: 8px; }
    input[type="text"], input[type="email"], input[type="password"], select {
      width: 100%;
      height: 44px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 15px;
    }
    .pw-wrap { position: relative; }
    .pw-toggle {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      border: 0;
      background: none;
      font-size: 13px;
      color: #374151;
      cursor: pointer;
      padding: 6px 8px;
    }
    .checkbox { display: flex; gap: 10px; align-items: flex-start; line-height: 1.4; }
    .checkbox input { transform: translateY(3px); }
    .notice {
      font-size: 13px;
      color: #b91c1c;
      background: #fef2f2;
      border: 1px solid #fee2e2;
      padding: 10px 12px;
      border-radius: 10px;
      margin: 8px 0 14px;
    }
    .actions { display: grid; gap: 8px; margin-top: 8px; }
    .btn {
      height: 44px;
      border-radius: 10px;
      border: 0;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
    }
    .btn:disabled { opacity: .6; cursor: not-allowed; }
    .btn-danger { background: var(--danger); color: #fff; }
    .btn-danger:hover { background: var(--danger-600); }
    .btn-ghost { background: transparent; color: #374151; border: 1px solid var(--border); }
    .help { text-align: center; color: var(--muted); font-size: 13px; margin-top: 8px; }
    .help a { color: #047857; text-decoration: none; }
    .hidden { display: none; }
    .center { text-align: center; }
  </style>
</head>
<body>
  <main>
    <div class="card">
      <h1>Runbickers</h1>
      <p class="subtitle">회원탈퇴</p>

      <form id="deleteForm" novalidate>
        <div class="field">
          <label for="nickname">닉네임</label>
          <input id="nickname" name="nickname" type="text" placeholder="닉네임을 입력하세요" autocomplete="nickname" />
        </div>

        <div class="field">
          <label for="email">이메일</label>
          <input id="email" name="email" type="email" placeholder="이메일을 입력하세요" autocomplete="email" required />
        </div>

        <div class="field">
          <label for="password">비밀번호</label>
          <div class="pw-wrap">
            <input id="password" name="password" type="password" minlength="8" placeholder="비밀번호를 입력하세요 (최소 8자)" autocomplete="current-password" required />
            <button type="button" id="togglePw" class="pw-toggle" aria-label="비밀번호 보기 전환">보기</button>
          </div>
        </div>

        <div class="field">
          <label for="passwordConfirm">비밀번호 확인</label>
          <input id="passwordConfirm" name="passwordConfirm" type="password" minlength="8" placeholder="비밀번호를 다시 입력하세요" required />
        </div>

        <div class="field">
          <label for="reason">탈퇴 사유 (선택)</label>
          <select id="reason" name="reason">
            <option value="">선택 안 함</option>
            <option value="rarely_use">사용 빈도 낮음</option>
            <option value="inconvenience">기능/사용성 불편</option>
            <option value="privacy">개인정보 우려</option>
            <option value="rejoin_later">재가입 예정</option>
            <option value="other">기타</option>
          </select>
        </div>

        <label class="checkbox">
          <input id="confirm" type="checkbox" required />
          <span>
            모든 데이터(프로필, 기록, 리더보드/리워드 등)가 영구 삭제됨을 이해하고 동의합니다.<br />
            이 작업은 되돌릴 수 없습니다.
          </span>
        </label>

        <div class="notice">
          보안을 위해 이메일 일치 확인과 비밀번호 재인증 후, 확인 이메일을 발송합니다.
          이메일의 링크를 클릭해야 최종 탈퇴가 완료됩니다(24시간 내 미확인 시 자동 취소).
        </div>

        <div class="actions">
          <button id="submitBtn" class="btn btn-danger" type="submit" disabled>회원탈퇴</button>
        </div>

        <p class="help">문의: <a href="mailto:runbickers@gmail.com">runbickers@gmail.com</a></p>
      </form>

      <div id="result" class="hidden">
        <h2 class="center">확인 이메일을 보냈습니다</h2>
        <p class="center">받은 편지함에서 링크를 클릭하면 탈퇴가 완료됩니다. (유효기간 24시간)</p>
        <div class="actions">
          <a class="btn btn-ghost center" href="./">홈으로</a>
        </div>
      </div>
    </div>
  </main>

  <script>
    const form = document.getElementById('deleteForm');
    const submitBtn = document.getElementById('submitBtn');
    const confirmCb = document.getElementById('confirm');
    const email = document.getElementById('email');
    const pw = document.getElementById('password');
    const pw2 = document.getElementById('passwordConfirm');
    const togglePw = document.getElementById('togglePw');

    function valid() {
      return form.checkValidity()
        && pw.value.length >= 8
        && pw.value === pw2.value
        && confirmCb.checked;
    }
    function updateSubmitState() {
      submitBtn.disabled = !valid();
    }
    ['input','change'].forEach(ev => form.addEventListener(ev, updateSubmitState));
    updateSubmitState();

    togglePw.addEventListener('click', () => {
      pw.type = pw.type === 'password' ? 'text' : 'password';
      togglePw.textContent = pw.type === 'password' ? '보기' : '숨기기';
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!valid()) return;

      submitBtn.disabled = true;
      submitBtn.textContent = '처리 중...';

      const payload = {
        email: email.value.trim(),
        password: pw.value,
        nickname: document.getElementById('nickname').value.trim(),
        reason: document.getElementById('reason').value,
      };

      // TODO: Supabase 연동
      // - Edge Function 예시: send-delete-confirm
      //   await fetch('https://<PROJECT>.functions.supabase.co/send-delete-confirm', {
      //     method: 'POST',
      //     headers: { 'Content-Type': 'application/json' },
      //     body: JSON.stringify(payload),
      //   });
      //
      // 서버에서 해야 할 일:
      // 1) 이메일/비밀번호 재검증
      // 2) 단일 사용 토큰 생성(테이블 저장: id/email/token/expiry/used)
      // 3) Supabase 이메일(또는 SMTP)로 확인 링크 전송
      //    링크: https://jeongwooshin.github.io/runbickers.github.io/account-deletion-confirm.html?token=...
      // 4) 응답 200이면 아래 화면 전환

      // 데모: 즉시 "확인 이메일 발송" 화면으로 전환
      document.getElementById('deleteForm').classList.add('hidden');
      document.getElementById('result').classList.remove('hidden');
    });
  </script>
</body>
</html>
